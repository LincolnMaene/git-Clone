import sys
import zlib

class treeUtils:
    
    def readTree(fileHash):
        
        fileLoc = f".git/objects/{fileHash[:2]}/{fileHash[2:]}"
        
        with open(fileLoc, "rb") as f:
            
            decompressedData = zlib.decompress(f.read())
            _, treeData = decompressedData.split(b"\0")
            
            while treeData:
                
                modeName,_ = treeData.split(b"\0", maxsplit = 1)
                _, name = modeName.split()
                print(name.decode("utf-8"))
                treeData = treeData[20:]

def main():
    try:
        commandList = []
        for cmd in sys.argv:
            commandList.append(cmd)
        if commandList[1] == "init":
            gitInit.createGitRepos()
        elif (commandList[1] == "cat-file") and (commandList[2] == "-p"):
            hashObjects.readBlob(commandList[3])
        elif (commandList[1] == "ls-tree") and (commandList[2] == "--name-only"):
            treeUtils.readTree(commandList[3])
        else:
            raise RuntimeError(f"Unknown git command")
    except IndexError: 
        print("No git cmd line argument found", file=sys.stderr)

if __name__ == "__main__":
    main()
